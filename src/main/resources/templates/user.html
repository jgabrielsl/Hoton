<!DOCTYPE html>
<html style="" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <title>Hoton</title>
  <link rel="shortcut icon" href="/resources/img/favicon.ico">

  <link rel="stylesheet" href="/resources/css/style-min.css">
  <link rel="stylesheet" href="/resources/css/common.css">


</head>

<body id="userEdit" class="font-o">
  
  <div th:replace="~{header :: NavBar(nome=${nome}, email=${email})}"></div>

  <section id="titulo">
    <div class="container-fluid bg-white" style="box-shadow:0px 5px 0px 0px rgba(0,0,0,0.01)">
      <div class="container d-flex justify-content-between align-items-center box-titulo">
        <i class="fas fa-chevron-right fa-1x"></i>
        <p class="text-uppercase mb-0">MINHA CONTA</p>
        <i class="fas fa-cogs fa-2x" style="color:#e9ecef;"> </i>
      </div>
    </div>
  </section>

  <section>
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="row justify-content-between mb-3 ml-1 mr-1 rounded pr-2 pl-2 pt-3 pb-3 flex-nowrap">
            <div class="d-flex align-items-center ">
              <img width="50" height="50" class="rounded-circle ml-1 mr-1"
                src="/resources/icons/user.svg">
              <p class="mb-0 ml-2"><b class="font14">Editar Conta </b><br><span class="font10"></span></p>
            </div>
            <div class="d-flex align-items-center ">
              <div class="ss">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section>
    <form id="form" method="post"
      action="/admin/user/edit" >
      <input type="hidden" name="id" id="inp_ID" th:value="${id}">
      <div class="container">
        <div class="row">
          <div class="col-12 col-md-6">
            <div class="row bg-white rounded my-shadow pt-3 pb-3 mr-1 ml-1 mb-2 ">
              <div class="col-12 f14cinza mb-2">
                Nome
              </div>
              <div class="col-12">
                <input type="text" class="form-control " id="inp_nome" name="nome" aria-describedby="inp_nome_help"
                  maxlength="30" th:value="${nome}">
              </div>
            </div>
          </div>
          <div class="col-12 col-md-6">
            <div class="row bg-white rounded my-shadow pt-3 pb-3 mr-1 ml-1 mb-2 ">
              <div class="col-12 f14cinza mb-2">
                Email
              </div>
              <div class="col-12">
                <input type="text" class="form-control " id="inp_email" aria-describedby="inp_email_help"
                  disabled="true"  th:value="${email}">
              </div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="row bg-white rounded my-shadow pt-3 pb-3 mr-1 ml-1 mb-2 ">
              <div class="col-12 f14cinza mb-2">
                Telefone
              </div>
              <div class="col-12">
                <input type="text" class="form-control " id="inp_telefone" name="numero"
                  aria-describedby="inp_telefone_help" data-msg-number="Número incorreto, Siga ex: 11911116666" 
                  maxlength="11" th:value="${numero}">
              </div>
            </div>
          </div>
          <div class="col-12 col-md-2">
            <div class="row bg-white rounded my-shadow pt-3 pb-3 mr-1 ml-1 mb-2 ">
              <div class="col-12 f14cinza mb-2 text-center">
                Alterar Senha
              </div>
              <div class="col-12">
                <input type="checkbox" class="form-control " id="alterSenha" name="alterSenha"
                  aria-describedby="alterSenha" value="true">
              </div>
            </div>
          </div>
          <div class="col-12 col-md-6 senha">
            <div class="row bg-white rounded my-shadow pt-3 pb-3 mr-1 ml-1 mb-2 ">
              <div class="col-12 f14cinza mb-2">
                Senha Atual
              </div>
              <div class="col-12">
                <input type="password" class="form-control " id="oldSenha" name="oldSenha"
                  aria-describedby="inp_senha_help" maxlength="20" minlength="4"
                  data-msg-minlength="Senha mínima de 4 dígitos">
              </div>
            </div>
          </div>
          <div class="col-12 col-md-6 senha">
            <div class="row bg-white rounded my-shadow pt-3 pb-3 mr-1 ml-1 mb-2 ">
              <div class="col-12 f14cinza mb-2">
                Nova Senha
              </div>
              <div class="col-12 col">
                <input type="password" class="form-control " id="newSenha" name="newSenha"
                  aria-describedby="inp_senha_help" maxlength="20" minlength="4"
                  data-msg-minlength="Senha mínima de 4 dígitos">
              </div>
            </div>
          </div>
          <div class="col-12 col-md-6 senha">
            <div class="row bg-white rounded my-shadow pt-3 pb-3 mr-1 ml-1 mb-2 ">
              <div class="col-12 f14cinza mb-2">
                Repita Nova Senha
              </div>
              <div class="col-12 col">
                <input type="password" class="form-control " id="confirmSenha" name="confirmSenha"
                  aria-describedby="inp_senha_help" maxlength="20" minlength="4"
                  data-msg-minlength="Senha mínima de 4 dígitos">
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col text-center mt-3 mt-md-5 mb-3">
            <button class="btn mybtn btn-ok mr-2" id="submit" type="submit"></button>
            <button class="btn mybtn btn-nok" type="button" onClick="window.location.href=window.location.href"></button>
          </div>
        </div>
      </div>
    </form>
  </section>

  <script src="/resources/js/vendors/jquery/jquery-3.5.1.min.js"></script>
  <script src="/resources/js/popper.min.js"></script>
  <script src="/resources/js/vendors/bootstrap4/bootstrap.min.js"></script>
  <script type="text/javascript">
  $(document).ready(function() {
	  $(".senha").hide();
	  
	  $("#alterSenha").change(function(){
		  $(".senha").toggle();
	  });
	  
      $("form").submit(function(e){
    	  
    	  if($("#alterSenha").is(":checked")){
	    	  var old = $("#oldSenha").val();
	    	  var aux = false;
	    	  $.ajax({
	    		  method: "POST",
	    		  url: "/admin/user/valid",
	    		  data: {pass: old},
	    		  async: false
	    		 }).done(function(msg){
	    		     if(msg == "false"){
	    		    	 alert("Verifique a senha atual!");
	    		    	 e.preventDefault(e);
	    		    	 aux = true;
	    		    	 return;
	    		     }
	    		    	 
	    		 })
	    		 .fail(function(jqXHR, textStatus, msg){
	    		      alert("Erro ao validar a senha atual! Tente novamente mais tarde.");
	    		      aux = true;
	    		      return;
	    		 });     
	    	  
	    	  if(aux)
	    		  return;
	    	  
	    	  var nova =$("#newSenha").val();
	          var confirm =$("#confirmSenha").val();
	          if(!nova || !confirm || nova !== confirm){
	        	  alert("Nova senha e confirmação não são iguais ou estão vazias!");
	        	  e.preventDefault(e);
	        	  return;
	          }
	          
	          if(nova === old){
	        	  alert("Senha atual e nova senha são iguais! Alteração cancelada.");
	        	  e.preventDefault(e);
	        	  return;
	          }
    	  }
      });
  });
  	
  </script>
  <th:block th:replace="~{tawk :: tawk}"></th:block>
</body>

</html>